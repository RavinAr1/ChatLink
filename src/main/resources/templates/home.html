<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ChatLink - Home</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="stylesheet" href="/css/output.css">
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">

<div th:replace="fragments/navbar :: navbar"></div>


<div class="container mx-auto mt-10 space-y-6">

    <div class="bg-gray-800 rounded-lg shadow-lg p-6">
        <h2 class="text-3xl font-bold mb-4">Welcome to ChatLink</h2>

        <div th:if="${user != null}">
            <h4 class="mb-2">Hello, <span th:text="${user.fullName}"></span> ðŸ‘‹</h4>
            <p class="mb-4"><strong>Your Unique Code:</strong> <span th:text="${user.uniqueCode}"></span></p>

            <div class="space-x-2">
                <a href="/connect" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md">Connect</a>
                <a href="/requests" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md">Requests</a>
                <a href="/chat" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-md">Open Chat</a>
            </div>
        </div>

        <div th:if="${user == null}" class="text-red-400">
            <p>User data not found. Please login again.</p>
            <a href="/login" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md mt-2 inline-block">Back to Login</a>
        </div>
    </div>

    <div class="bg-gray-800 rounded-lg shadow-lg p-6">
        <h5 class="mb-2">Scan Your QR to Share</h5>
        <img id="qrCode" src="/user/qr" alt="Your QR Code" class="w-48 cursor-pointer rounded-lg shadow-lg"
             onclick="expandQR()">
        <a id="downloadQR" class="inline-block mt-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded" download="ChatLink-QR.png">Download QR</a>
    </div>

</div>

<script>
    function expandQR() {
        const img = document.getElementById('qrCode');
        const win = window.open("");
        win.document.write('<img src="' + img.src + '" style="width:400px;">');
    }
    const qrImg = document.getElementById('qrCode');
    const downloadLink = document.getElementById('downloadQR');
    downloadLink.href = qrImg.src;
</script>

</body>
</html>
