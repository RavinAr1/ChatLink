<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ChatLink - Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="icon" type="image/png" href="/images/logo.png">

    <link rel="stylesheet" href="/css/output.css">
</head>


<body class="bg-gray-900 text-gray-100 min-h-screen">

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container mx-auto mt-6 px-4 space-y-6">


    <!-- Welcome Card -->
    <div class="bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6">
        <h2 class="text-2xl sm:text-3xl font-bold mb-4 text-center">Welcome to ChatLink</h2>


        <div th:if="${user != null}" class="text-center sm:text-left">
            <h4 class="mb-2 text-lg sm:text-xl">Hello, <span th:text="${user.fullName}"></span> ðŸ‘‹</h4>
            <p class="mb-4"><strong>Your Unique Code:</strong> <span th:text="${user.uniqueCode}"></span></p>

            <div class="flex flex-col sm:flex-row justify-center sm:justify-start gap-2">
                <a href="/connect" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md text-center">Connect</a>
                <a href="/requests" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-center">Requests</a>
                <a href="/chat" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-md text-center">Open Chat</a>
            </div>
        </div>


        <div th:if="${user == null}" class="text-red-400 text-center">
            <p>User data not found. Please login again.</p>
            <a href="/login" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-md mt-2 inline-block">Back to Login</a>
        </div>
    </div>


    <!-- QR Code Card -->
    <div class="bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 text-center">
        <h5 class="mb-2 text-lg sm:text-xl">Scan Your QR to Share</h5>
        <img id="qrCode" src="/user/qr" alt="Your QR Code"
             class="w-40 sm:w-48 mx-auto cursor-pointer rounded-lg shadow-lg"
             onclick="expandQR()">

        <a id="downloadQR" class="inline-block mt-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded" download="ChatLink-QR.png">Download QR</a>
    </div>

</div>

<script>
    function expandQR() {
        const img = document.getElementById('qrCode');
        const win = window.open("");
        win.document.write('<img src="' + img.src + '" style="width:400px;">');
    }
    const qrImg = document.getElementById('qrCode');
    const downloadLink = document.getElementById('downloadQR');
    downloadLink.href = qrImg.src;
</script>

</body>
</html>
